.PHONY: all simulate clean view help

# Variables
VERILOG_FILES = master.v slave.v testbench.v
VVP_FILE = spi.vvp
VCD_FILE = spi_chain.vcd
GTKW_FILE = completo.gtkw

all: view

simulate: $(VVP_FILE)
	@echo "ğŸš€ Simulando SPI..."
	vvp $(VVP_FILE)

$(VVP_FILE): $(VERILOG_FILES)
	@echo "ğŸ”§ Compilando SPI..."
	iverilog -o $(VVP_FILE) $(VERILOG_FILES)

view: simulate
	@echo "ğŸ“Š Abriendo GTKWave..."
	@if [ -f $(GTKW_FILE) ]; then \
		gtkwave $(VCD_FILE) $(GTKW_FILE) & \
	else \
		gtkwave $(VCD_FILE) & \
		echo "âš ï¸  Archivo $(GTKW_FILE) no encontrado. GTKWave abierto sin configuraciÃ³n."; \
	fi

clean:
	@echo "ğŸ§¹ Limpiando archivos..."
	rm -f $(VVP_FILE) $(VCD_FILE) *.vvp *.vcd

help:
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘        SPI Makefile - Comandos         â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Comandos disponibles:"
	@echo "  make              - Compila, simula y abre GTKWave"
	@echo "  make simulate     - Solo compila y simula"
	@echo "  make view         - Compila, simula y abre GTKWave"
	@echo "  make clean        - Elimina archivos generados"
	@echo "  make help         - Muestra esta ayuda"
	@echo ""
	@echo "Requisitos:"
	@echo "  - iverilog (para compilaciÃ³n)"
	@echo "  - vvp (para simulaciÃ³n)"
	@echo "  - gtkwave (para visualizaciÃ³n)"
	@echo "  - complete.gtkw (archivo de configuraciÃ³n GTKWave, opcional)"